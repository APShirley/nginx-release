#!/bin/bash

set -e

URL=<%= p('fetcher.url') %>
OUTPUT_PATH=<%= p('fetcher.output_path') %>

mkdir -p `dirname $OUTPUT_PATH`

while true
do
  echo "`date` Fetching $URL to $OUTPUT_PATH"
  curl --silent --show-error --output $OUTPUT_PATH.tmp $URL
  mv $OUTPUT_PATH.tmp $OUTPUT_PATH
  sleep <%= p('fetcher.sleep') %>
done
